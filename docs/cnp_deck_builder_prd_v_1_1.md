# CNP TCG Deck Builder — Product Requirements Document (PRD)

*Version 1.0 – 2025‑07‑25*

| Section                 | Owner | Status |
| ----------------------- | ----- | ------ |
| Strategy & Vision       | ヒロ    | ✅      |
| Functional Requirements | ヒロ    | ✅      |
| Non‑functional          | ヒロ    | ✅      |
| Open Questions          | ヒロ    | 🚧     |

---

## 1. プロダクト概要

**目的**

> ブラウザだけで動く CNP TCG 専用の *Deck Builder & Match Tracker* を提供し、プレイヤーがカード情報を検索しながらデッキを構築し、試合結果を記録して戦績を可視化できるようにする。

**コア価値**

1. **ワンストップ** – デッキ編成／カード検索／戦績管理を一画面で。
2. **オフライン対応** – PWA とローカルキャッシュで大会会場でも快適利用。
3. **画像付き UI** – カードイラストを即表示し、視覚的にカードを把握。

---

## 2. スコープ

### 2.1 MVP 機能

- **カードデータベース**
  - JSON + 画像 (Supabase CDN or 自前 S3) を事前ビルドでバンドル
  - Fuzzy 検索 (Fuse.js)／色・コスト・種族フィルタ
- **デッキビルダー**
  - カードサムネ → Drag & Drop or Click でデッキ枠へ追加 / 削除
  - 枚数上限 50、色均衡チェック、同一カード枚数制限 (RR 2, R 4 ... TBD)
  - ローカル保存 (localStorage) + Deck URL (base64 クエリ) 共有
- **カード詳細モーダル**
  - 効果文・フレーバー・レアリティ・大きめ画像を表示
- **戦績トラッカー**
  - 試合日時・対戦相手名・使用デッキ・勝敗・メモを入力
  - IndexedDB (idb‑keyval) に保存
  - 基礎統計 (勝率, 先攻勝率, 後攻勝率)
- **PWA**
  - オフラインアクセス、ホーム画面への追加、App Icon

### 2.2 今後の拡張

- クラウド同期 (Supabase Row Level Security)
- QR コードでデッキ共有
- MetaMask 連携で NFT 所有カードを自動フェッチ
- 対戦ログを CSV / PDF エクスポート

### 2.3 非スコープ (MVP)

- AI デッキレコメンド
- リアルタイム多人数コラボ編集
- 多言語 (日本語のみ)

---

## 3. ターゲットユーザー

| Persona     | needs                       | pain‑points           |
| ----------- | --------------------------- | --------------------- |
| **競技プレイヤー** | 最速でカード検索 & デッキ管理            | 既存サイトに画像がなく視覚的に把握しづらい |
| **新規プレイヤー** | 効果文を読みやすく、色・コストフィルタで候補を絞りたい | 公式 FAQ が分散し学習コスト高     |
| **大会主催者**   | 戦績集計でメタゲーム分析したい             | Google Sheet 手入力が面倒   |

---

## 4. ユーザーストーリー (MVP)

1. *検索* ― 「BP≥5000 で奪取効果持ちカード」を素早く絞り込む。
2. *デッキ構築* ― カードをクリックして 50 枚になると警告が出る。
3. *保存* ― ブラウザを閉じてもデッキが残る。
4. *共有* ― 生成された URL を友人に送ると同じデッキが表示。
5. *戦績入力* ― 大会終了後、対戦結果とメモを 30 秒以内に記録。
6. *統計閲覧* ― 今月の勝率と使用デッキ別勝敗がグラフで見える。

---

## 5. 主要機能詳細

### 5.1 デッキビルダー UI

```
┌─────────────────────────────────────────┐
│  🔍 検索…[奪取]  色🟢🔴🟡🔵  コスト0‑9         │
├─────────────────────────────────────────┤
│  Card Grid (lazy‑load, 5×N)                   │
│                                               │
│  ┌─────────────┐  …                        │
│  │  📄 image     │  ← 上端にコストバッジ        │
│  │               │                             │
│  │      +        │  ← hover で Gold ＋ ボタン    │
│  │ 1/4 ⓘ        │  ← 右下に **枚数バッジ**        │
│  └─────────────┘                             │
│                                               │
├───────────────┬──────────────────────────────┤
│ Deck Panel    │ デッキ 12 / 50               │
│ (右固定)      │ 色均衡 🟢14 🔴8               │
│               │ ▼カードサムネ(64×90)          │
│ ┌────┐×2  ブレイズ                         │
│ └────┘×1  マカミ                           │
│               │                               │
│ CLEAR  EXPORT │                               │
└───────────────┴──────────────────────────────┘
```

**改良ポイント**

- **枚数バッジ (1/4, 2/4 …)** : `absolute bottom-1 right-1 rounded-full bg-white/90 w-7 h-7 flex items-center justify-center text-[10px] font-bold`。
- **DeckPanel サムネ** : 64×90px WebP。枠線色でカード色を示す。
- PLUS ボタン (dnd‑kit) はスマホでは long‑press add。

### 5.2 コンポーネント一覧 コンポーネント一覧

| Component           | 役割                        |
| ------------------- | ------------------------- |
| `<FilterBar>`       | 検索 Input・色/コストフィルタ        |
| `<CardGrid>`        | 158 枚を virtual scroll 表示  |
| `<CardThumbnail>`   | 画像＋メタ。onClick: add/remove |
| `<CardDetailModal>` | 効果・画像拡大表示                 |
| `<DeckPanel>`       | 枚数／色／コスト統計・ボタン            |
| `useDeck()`         | Zustand。add/remove・検証・保存  |
| `useCardDB()`       | JSON 読込＋Fuse.js インデックス    |

### 5.3 技術採用

- **フレームワーク** : Vite + React + Tailwind (shadcn/ui)。
- **状態管理** : Zustand。IndexedDB (idb‑keyval) for match log。
- **画像** : Supabase CDN そのまま or Cloudflare R2 。256×356 WebP & `loading="lazy"`。
- **PWA** : workbox injectManifest でオフライン。

## 6. 非機能要件 非機能要件

| 区分           | 要件                            | 指標                   |
| ------------ | ----------------------------- | -------------------- |
| **パフォーマンス**  | LCP < 2.5 s (4G), JS < 150 kB | Lighthouse 90+       |
| **オフライン**    | 検索/デッキ編集/戦績登録が全て機能            | PWA audits PASS      |
| **アクセシビリティ** | WCAG 2.1 AA                   | Lighthouse A11y > 90 |
| **セキュリティ**   | XSS/CSRF 対策 (DOMPurify)       | OWASP ZAP Medium 0   |

---

## 7. 測定指標 (Success Metrics)

| KPI                | 目標 (90 日) |
| ------------------ | --------- |
| MAU                | 500+      |
| 1 セッションあたりデッキ作成完了率 | 70 %      |
| 戦績入力継続率 (3 回以上)    | 40 %      |
| 平均 LCP             | < 2 s     |

---

## 8. 依存 & リスク

- 公式カード画像 CDN の利用許諾 / 帯域制限
- 今後のカード追加時、データ自動更新パイプラインが必要
- 大会環境の電波状況 → オフライン PWA でカバー

---

## 9. タイムライン (暫定)

| Phase                | 期間  | Deliverable                |
| -------------------- | --- | -------------------------- |
| **データ ETL + JSON 化** | 1 d | cards.json, 画像 DL script   |
| **MVP UI 実装**        | 5 d | 検索 / デッキビルド画面動作            |
| **戦績機能**             | 3 d | ログ入力 + Stats chart         |
| **PWA + QA**         | 2 d | Lighthouse 90+/Off‑line OK |
| **公開**               | 1 d | Vercel Deploy + ドメイン       |

---

## 10. 未解決事項 / 今後検討

- レギュレーション変更 (枚数制限) へのダイナミック対応
- NFT 所有者限定スキン切替
- 多言語化 (英語, 韓国語)

